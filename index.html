<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Journal Piscine</title>

<meta name="theme-color" content="#0b1220">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="manifest" href="manifest.webmanifest">

<style>
body{margin:0;background:#0b1220;color:#e6eefc;font-family:system-ui}
.wrap{max-width:980px;margin:auto;padding:20px}
.card{background:#121b2e;border-radius:14px;padding:16px;margin-bottom:14px}
h1{margin:0 0 14px}
input,button,select{width:100%;padding:12px;border-radius:12px;border:1px solid #26365f;background:#0c1427;color:#fff}
button{font-weight:700;cursor:pointer}
.btn{background:#4f7cff}
.btn2{background:#162243}
.danger{background:#ff4f6a}
.kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
.kpi{background:#0c1427;border-radius:12px;padding:12px;border:1px solid #26365f}
.kpi .t{font-size:12px;opacity:.8}
.kpi .v{font-size:18px;font-weight:700}
.pill{background:#0c1427;padding:4px 8px;border-radius:999px;font-size:12px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:10px;border-bottom:1px solid #26365f;font-size:13px}
.right{text-align:right}
</style>
</head>

<body>
<div class="wrap">
<h1>üèä Journal Piscine</h1>

<div class="card">
<input id="date" type="date"><br><br>
<input id="poolLen" type="number" placeholder="Longueur bassin (m)" value="25"><br><br>
<input id="laps" type="number" placeholder="Nombre de longueurs"><br><br>
<input id="minutes" type="number" placeholder="Temps (min)"><br><br>
<input id="note" placeholder="Note"><br><br>

<button class="btn" onclick="addSession()">Ajouter la session</button><br><br>
<button class="btn2" onclick="exportJSON()">Exporter JSON</button><br><br>
<button class="btn2" onclick="importJSON()">Importer JSON</button><br><br>
<button class="danger" onclick="wipeAll()">Tout effacer</button>

<div class="kpis">
<div class="kpi"><div class="t">Distance totale</div><div class="v" id="kDistance">‚Äî</div></div>
<div class="kpi"><div class="t">Allure moyenne</div><div class="v" id="kPace">‚Äî</div></div>
<div class="kpi"><div class="t">Vitesse moyenne</div><div class="v" id="kSpeed">‚Äî</div></div>
<div class="kpi"><div class="t">Cadence moyenne</div><div class="v" id="kRate">‚Äî</div></div>
</div>

<div id="kMeta" style="margin-top:8px;font-size:12px;opacity:.8"></div>
</div>

<div class="card">
<div class="pill" id="countPill"></div>
<div class="pill" id="sumPill"></div>

<table>
<thead>
<tr>
<th>Date</th>
<th>D√©tails</th>
<th class="right">Distance</th>
<th class="right">Temps</th>
<th class="right">Allure</th>
<th></th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
</div>

<script>
const STORAGE_KEY="swim_sessions_v1";
const $=id=>document.getElementById(id);

function todayISO(){return new Date().toISOString().slice(0,10)}
$("date").value=todayISO()

function meters(l,p){return Number(l)*Number(p)}
function pace(m,t){return t/(m/100)}
function fmtPace(p){if(!p)return"‚Äî";const s=Math.round(p*60);return Math.floor(s/60)+":"+String(s%60).padStart(2,"0")}
function speed(m,t){return(m/1000)/(t/60)}
function rate(m,t){return m/t}

function load(){return JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]")}
function save(d){localStorage.setItem(STORAGE_KEY,JSON.stringify(d))}

function addSession(){
const s={
id:Date.now(),
date:$("date").value,
poolLen:+$("poolLen").value,
laps:+$("laps").value,
minutes:+$("minutes").value,
note:$("note").value,
totalMeters:meters($("laps").value,$("poolLen").value)
}
const d=load();d.push(s);save(d);render()
}

function render(){
const d=load()
let tm=0,tt=0
d.forEach(x=>{tm+=x.totalMeters;tt+=x.minutes})

$("kDistance").textContent=tm+" m"
$("kPace").textContent=fmtPace(pace(tm,tt))
$("kSpeed").textContent=speed(tm,tt).toFixed(2)+" km/h"
$("kRate").textContent=rate(tm,tt).toFixed(1)+" m/min"
$("kMeta").textContent=`${d.length} sessions ‚Ä¢ ${tt} min`

$("countPill").textContent=d.length+" sessions"
$("sumPill").textContent="Total "+tm+" m"

$("tbody").innerHTML=""
d.slice().reverse().forEach(s=>{
const tr=document.createElement("tr")
tr.innerHTML=`<td>${s.date}</td>
<td>${s.laps}x${s.poolLen}m ${s.note||""}</td>
<td class="right">${s.totalMeters} m</td>
<td class="right">${s.minutes} min</td>
<td class="right">${fmtPace(pace(s.totalMeters,s.minutes))}</td>
<td><button onclick="del(${s.id})">Suppr</button></td>`
$("tbody").appendChild(tr)
})
}

function del(id){save(load().filter(x=>x.id!=id));render()}

function exportJSON(){
const b=new Blob([JSON.stringify(load(),null,2)],{type:"application/json"})
const a=document.createElement("a")
a.href=URL.createObjectURL(b);a.download="sessions.json";a.click()
}

function importJSON(){
const i=document.createElement("input");i.type="file"
i.onchange=e=>{
const f=e.target.files[0]
f.text().then(t=>{save(JSON.parse(t));render()})
}
i.click()
}

function wipeAll(){if(confirm("Effacer ?")){localStorage.clear();render()}}

render()
</script>

<script>
if("serviceWorker"in navigator){
navigator.serviceWorker.register("./sw.js")
}
</script>

</body>
</html>